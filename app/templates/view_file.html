{% extends 'base.html' %}

{% block title %}Viewing: {{ filename }} - DocHub{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card glow-primary">
                <div class="card-body py-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="mb-2"><i class="fas fa-file-alt me-3 text-primary"></i>Viewing: {{ filename }}</h1>
                            <p class="mb-0 text-muted">Document content preview</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Content -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-code me-2"></i>File Content</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-light me-2" onclick="copyToClipboard()">
                                <i class="fas fa-copy me-1"></i>Copy
                            </button>
                            <button class="btn btn-sm btn-outline-light" onclick="toggleWrap()">
                                <i class="fas fa-text-width me-1"></i>Toggle Wrap
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <pre id="file-content" class="mb-0 p-4" style="background-color: #161b22; color: #c9d1d9; font-family: 'Fira Code', 'Monaco', 'Consolas', monospace; font-size: 0.9em; line-height: 1.5; white-space: pre; overflow-x: auto; max-height: 70vh; overflow-y: auto;">{{ content }}</pre>
                </div>
                <div class="card-footer bg-dark text-white">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                File size: {{ content|length }} characters
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                Last viewed: {{ moment().format('MMM DD, YYYY HH:mm') }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary w-100">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a>
                        </div>
                        <div class="col-md-3">
                            <button onclick="window.print()" class="btn btn-info w-100">
                                <i class="fas fa-print me-2"></i>Print
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button onclick="downloadFile()" class="btn btn-success w-100">
                                <i class="fas fa-download me-2"></i>Download
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button onclick="shareFile()" class="btn btn-warning w-100">
                                <i class="fas fa-share me-2"></i>Share
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Copy to clipboard functionality
function copyToClipboard() {
    const content = document.getElementById('file-content').textContent;
    navigator.clipboard.writeText(content).then(function() {
        // Show success message
        showToast('Content copied to clipboard!', 'success');
    }, function(err) {
        showToast('Failed to copy content', 'error');
    });
}

// Toggle word wrap
function toggleWrap() {
    const pre = document.getElementById('file-content');
    if (pre.style.whiteSpace === 'pre-wrap') {
        pre.style.whiteSpace = 'pre';
    } else {
        pre.style.whiteSpace = 'pre-wrap';
    }
}

// Download file
function downloadFile() {
    const content = document.getElementById('file-content').textContent;
    const filename = "{{ filename }}";
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showToast('File download started!', 'success');
}

// Share file (placeholder)
function shareFile() {
    const filename = "{{ filename }}";
    if (navigator.share) {
        navigator.share({
            title: filename,
            text: 'Check out this file: ' + filename,
            url: window.location.href
        });
    } else {
        // Fallback: copy URL to clipboard
        navigator.clipboard.writeText(window.location.href).then(function() {
            showToast('File URL copied to clipboard!', 'success');
        });
    }
}

// Toast notification function
function showToast(message, type) {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

    document.body.appendChild(toast);

    // Auto remove after 3 seconds
    setTimeout(() => {
        if (toast.parentNode) {
            toast.remove();
        }
    }, 3000);
}

// Syntax highlighting for code files (basic)
document.addEventListener('DOMContentLoaded', function() {
    const pre = document.getElementById('file-content');
    const filename = "{{ filename }}".toLowerCase();

    // Add basic syntax highlighting for common file types
    if (filename.endsWith('.py')) {
        // Python syntax highlighting
        pre.innerHTML = pre.innerHTML
            .replace(/\b(def|class|if|elif|else|for|while|try|except|import|from|return|print)\b/g, '<span style="color: #ff7b72;">$1</span>')
            .replace(/(["'`])(.*?)\1/g, '<span style="color: #a5c9ea;">$1$2$1</span>')
            .replace(/\b(True|False|None)\b/g, '<span style="color: #79c0ff;">$1</span>');
    } else if (filename.endsWith('.js') || filename.endsWith('.ts')) {
        // JavaScript/TypeScript syntax highlighting
        pre.innerHTML = pre.innerHTML
            .replace(/\b(function|const|let|var|if|else|for|while|return|console)\b/g, '<span style="color: #ff7b72;">$1</span>')
            .replace(/(["'`])(.*?)\1/g, '<span style="color: #a5c9ea;">$1$2$1</span>');
    }
});
</script>
{% endblock %}
